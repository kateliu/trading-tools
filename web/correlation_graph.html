<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Ticker Correlation Graph</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f5f5f5; }
    header { padding: 1rem 1.5rem; background: #1f2937; color: white; }
    #chart { width: 100%; height: calc(100vh - 140px); }
    svg { width: 100%; height: 100%; }
    .node circle { stroke: #1f2937; stroke-width: 1.5px; cursor: grab; }
    .node text { pointer-events: none; font-size: 13px; font-weight: 600; fill: #1f2937; }
    .link { stroke-opacity: 0.4; }
    .highlight-node circle { stroke: #111827; stroke-width: 3px; }
    .dimmed { opacity: 0.15; }
    .legend { margin-top: 0.75rem; display: flex; gap: 1.25rem; flex-wrap: wrap; font-size: 0.9rem; }
    .legend-item { display: flex; align-items: center; gap: 0.4rem; }
    .legend-swatch { width: 16px; height: 16px; border-radius: 4px; border: 1px solid rgba(17, 24, 39, 0.4); }
    .legend-swatch.positive { background: linear-gradient(90deg, #b7e4c7, #1b4332); }
    .legend-swatch.negative { background: #ff6b6b; opacity: 0.7; }
    footer { padding: 0.75rem 1.5rem; background: #e5e7eb; font-size: 0.9rem; }
</style>
</head>
<body>
<header>
    <h1>Ticker Correlation Graph</h1>
    <p>metric=log_return, edges shown where |corr| â‰¥ 0.68</p>
    <div class="legend">
        <span class="legend-item"><span class="legend-swatch positive"></span>Positive correlation (darker = stronger)</span>
        <span class="legend-item"><span class="legend-swatch negative"></span>Negative correlation</span>
    </div>
</header>
<div id="chart"></div>
<footer>Click a ticker to highlight its direct correlations. Drag nodes to reposition them.</footer>
<script>
const data = {"nodes": [{"id": "AAPL", "label": "AAPL"}, {"id": "ACHR", "label": "ACHR"}, {"id": "ADBE", "label": "ADBE"}, {"id": "AMD", "label": "AMD"}, {"id": "AMZN", "label": "AMZN"}, {"id": "APLD", "label": "APLD"}, {"id": "APP", "label": "APP"}, {"id": "ASAN", "label": "ASAN"}, {"id": "BBAI", "label": "BBAI"}, {"id": "BLSH", "label": "BLSH"}, {"id": "BMNR", "label": "BMNR"}, {"id": "BULL", "label": "BULL"}, {"id": "CEG", "label": "CEG"}, {"id": "CHYM", "label": "CHYM"}, {"id": "COIN", "label": "COIN"}, {"id": "CORZ", "label": "CORZ"}, {"id": "CRCL", "label": "CRCL"}, {"id": "CRM", "label": "CRM"}, {"id": "CRWV", "label": "CRWV"}, {"id": "DUOL", "label": "DUOL"}, {"id": "FIG", "label": "FIG"}, {"id": "FIGR", "label": "FIGR"}, {"id": "FOUR", "label": "FOUR"}, {"id": "GRAB", "label": "GRAB"}, {"id": "HIMS", "label": "HIMS"}, {"id": "HOOD", "label": "HOOD"}, {"id": "IRDM", "label": "IRDM"}, {"id": "KLAR", "label": "KLAR"}, {"id": "KTOS", "label": "KTOS"}, {"id": "LAC", "label": "LAC"}, {"id": "LEU", "label": "LEU"}, {"id": "MDB", "label": "MDB"}, {"id": "META", "label": "META"}, {"id": "MP", "label": "MP"}, {"id": "MSFT", "label": "MSFT"}, {"id": "MSTR", "label": "MSTR"}, {"id": "MU", "label": "MU"}, {"id": "NBIS", "label": "NBIS"}, {"id": "NOTE", "label": "NOTE"}, {"id": "NU", "label": "NU"}, {"id": "NVDA", "label": "NVDA"}, {"id": "NVO", "label": "NVO"}, {"id": "OKLO", "label": "OKLO"}, {"id": "OKTA", "label": "OKTA"}, {"id": "ONDS", "label": "ONDS"}, {"id": "ORCL", "label": "ORCL"}, {"id": "OSCR", "label": "OSCR"}, {"id": "PDD", "label": "PDD"}, {"id": "PINS", "label": "PINS"}, {"id": "PLTR", "label": "PLTR"}, {"id": "PONY", "label": "PONY"}, {"id": "PYPL", "label": "PYPL"}, {"id": "QBTS", "label": "QBTS"}, {"id": "RCAT", "label": "RCAT"}, {"id": "RGTI", "label": "RGTI"}, {"id": "SHOP", "label": "SHOP"}, {"id": "SMCI", "label": "SMCI"}, {"id": "SNAP", "label": "SNAP"}, {"id": "SOFI", "label": "SOFI"}, {"id": "SOXX", "label": "SOXX"}, {"id": "TEM", "label": "TEM"}, {"id": "TMQ", "label": "TMQ"}, {"id": "TSLA", "label": "TSLA"}, {"id": "TSM", "label": "TSM"}, {"id": "TTD", "label": "TTD"}, {"id": "U", "label": "U"}, {"id": "UNH", "label": "UNH"}, {"id": "UPST", "label": "UPST"}, {"id": "UUUU", "label": "UUUU"}, {"id": "VOO", "label": "VOO"}, {"id": "VRT", "label": "VRT"}, {"id": "VST", "label": "VST"}], "links": [{"source": "AMD", "target": "APP", "weight": -0.7810104592305189}, {"source": "APP", "target": "IRDM", "weight": -0.7126835854544183}, {"source": "ASAN", "target": "IRDM", "weight": 0.7797349272937351}, {"source": "ASAN", "target": "SOXX", "weight": 0.7162423604511801}, {"source": "BMNR", "target": "FOUR", "weight": 0.7154970593161545}, {"source": "CEG", "target": "MDB", "weight": 0.6859226798199453}, {"source": "CEG", "target": "VOO", "weight": 0.6845517766197353}, {"source": "COIN", "target": "CRCL", "weight": 0.7764826769341271}, {"source": "COIN", "target": "MSTR", "weight": 0.8660400621899681}, {"source": "CORZ", "target": "CRWV", "weight": 0.7145583033301597}, {"source": "CORZ", "target": "VRT", "weight": 0.6938429331833017}, {"source": "HIMS", "target": "PLTR", "weight": 0.7201128368632334}, {"source": "IRDM", "target": "SOXX", "weight": 0.7311779133485141}, {"source": "LEU", "target": "MP", "weight": 0.6838077012142968}, {"source": "MSTR", "target": "MU", "weight": 0.7264667559099697}, {"source": "MU", "target": "NVO", "weight": 0.7506546368305002}, {"source": "MU", "target": "SMCI", "weight": 0.711654596383795}, {"source": "NVDA", "target": "VRT", "weight": 0.681364235903712}, {"source": "OKLO", "target": "PONY", "weight": 0.718465207401837}, {"source": "QBTS", "target": "RGTI", "weight": 0.8161521796928983}, {"source": "VOO", "target": "VRT", "weight": 0.7210150175755992}]};
const threshold = 0.68;
const width = document.getElementById('chart').clientWidth;
const height = document.getElementById('chart').clientHeight;

const svg = d3.select('#chart').append('svg')
    .attr('viewBox', '0 0 ' + width + ' ' + height)
    .call(d3.zoom().on('zoom', function(event) { svgGroup.attr('transform', event.transform); }));

const svgGroup = svg.append('g');

const strokeScale = d3.scaleLinear()
    .domain([threshold, 1])
    .range([0.4, 0.9]);
const colorScale = d3.scaleLinear()
    .domain([threshold, 1])
    .range(['#b7e4c7', '#1b4332']);

const link = svgGroup.selectAll('.link')
    .data(data.links)
    .enter()
    .append('line')
    .attr('class', function(d) { return 'link ' + (d.weight >= 0 ? 'positive' : 'negative'); })
    .attr('stroke-width', function(d) { return Math.max(1.5, Math.abs(d.weight) * 4); })
    .attr('stroke', function(d) {
        var magnitude = Math.abs(d.weight);
        return d.weight >= 0 ? colorScale(Math.min(magnitude, 1)) : '#ff6b6b';
    })
    .attr('stroke-opacity', function(d) {
        var magnitude = Math.abs(d.weight);
        return d.weight >= 0 ? strokeScale(Math.min(magnitude, 1)) : 0.6;
    });

const nodeGroup = svgGroup.selectAll('.node')
    .data(data.nodes)
    .enter()
    .append('g')
    .attr('class', 'node')
    .call(d3.drag()
        .on('start', dragstarted)
        .on('drag', dragged)
        .on('end', dragended));

nodeGroup.append('circle')
    .attr('r', 20)
    .attr('fill', '#60a5fa');

nodeGroup.append('text')
    .attr('text-anchor', 'middle')
    .attr('dy', '0.35em')
    .text(function(d) { return d.label; });

const simulation = d3.forceSimulation(data.nodes)
    .force('link', d3.forceLink(data.links).id(function(d) { return d.id; }).distance(160).strength(0.4))
    .force('charge', d3.forceManyBody().strength(-500))
    .force('center', d3.forceCenter(width / 2, height / 2))
    .on('tick', ticked);

const adjacency = new Map();
for (const node of data.nodes) { adjacency.set(node.id, new Set()); }
for (const edge of data.links) {
    adjacency.get(edge.source).add(edge.target);
    adjacency.get(edge.target).add(edge.source);
}

nodeGroup.on('click', function(event, node) { highlight(node.id); });
svg.on('click', function(event) {
    if (event.target.tagName === 'svg') highlight(null);
});

function highlight(selectedId) {
    if (!selectedId) {
        nodeGroup.classed('dimmed highlight-node', false);
        link.classed('dimmed', false);
        return;
    }
    const neighbors = adjacency.get(selectedId) || new Set();
    nodeGroup.classed('highlight-node', function(d) { return d.id === selectedId; })
        .classed('dimmed', function(d) { return d.id !== selectedId && !neighbors.has(d.id); });
    link.classed('dimmed', function(d) { return !(d.source.id === selectedId || d.target.id === selectedId); });
}

function ticked() {
    link
        .attr('x1', function(d) { return d.source.x; })
        .attr('y1', function(d) { return d.source.y; })
        .attr('x2', function(d) { return d.target.x; })
        .attr('y2', function(d) { return d.target.y; });

    nodeGroup.attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')'; });
}

function dragstarted(event, d) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
}

function dragged(event, d) {
    d.fx = event.x;
    d.fy = event.y;
}

function dragended(event, d) {
    if (!event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
}
</script>
</body>
</html>
